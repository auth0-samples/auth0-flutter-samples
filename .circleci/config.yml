version: 2.1
orbs:
  flutter: circleci/flutter@1
parameters:
  flutter_version:
    type: string
    default: 3.0.4
jobs:
  analyze:
    docker:
      - image: cimg/base:current
    steps:
      - checkout
      - flutter/install_sdk_and_pub:
          app-dir: ./sample
          flutter_version: << pipeline.parameters.flutter_version >>
      - run:
          name: Analyze package
          command: |
            cp .env.example .env
            flutter analyze
          working_directory: ./sample
      - run: echo "Hello, world!" > workspace/build
      - persist_to_workspace:
          # Must be an absolute path, or relative path from working_directory. This is a directory on the container which is
          # taken to be the root directory of the workspace.
          root: workspace
          # Must be relative path from root
          paths:
            - build
  test:
    docker:
      - image: cimg/base:current
    steps:
      - attach_workspace:
          # Must be absolute path or relative path from working_directory
          at: workspace
      - run: ls workspace
workflows:
  build_and_test:
    jobs:
      - analyze
      - test
        requires:
          - analyze